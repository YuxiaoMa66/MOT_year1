"0","# Function to add the new variable ""leaf_mean"" to the testing data's dataframe column by using the mean_value from the training data's leaf node"
"0","# which means for the same path, we use the same mean_value for the testing data in the column ""leaf_mean"""
"0","add_leaf_mean <- function(test_data, leaves_data) {"
"0","  # 初始化 leaf_mean 列为 NA"
"0","  test_data$leaf_mean <- NA"
"0",""
"0","  for (i in seq_along(leaves_data)) {"
"0","    path_conditions <- leaves_data[[i]]$path"
"0","    mean_value <- leaves_data[[i]]$data$leaf_mean # 假设每个叶节点数据中有一个 leaf_mean 值"
"0",""
"0","    # 为每个叶节点构建一个逻辑索引向量，初始值为 TRUE"
"0","    index_vector <- rep(TRUE, nrow(test_data))"
"0",""
"0","    # 更新索引向量以反映路径条件"
"0","    for (condition in path_conditions) {"
"0","      parts <- strsplit(condition, "" = "")[[1]]"
"0","      variable <- parts[1]"
"0","      value <- as.numeric(parts[2])"
"0",""
"0","      # 仅保留同时满足所有条件的行"
"0","      index_vector <- index_vector & (test_data[[variable]] == value)"
"0","    }"
"0",""
"0","    # 一次性更新所有满足条件的行"
"0","    test_data$leaf_mean[index_vector] <- mean_value"
"0","  }"
"0",""
"0","  return(test_data)"
"0","}"
"0",""
