"0","# Function to add the new variable ""leaf_mean"" to the testing data's dataframe column by using the mean_value from the training data's leaf node"
"0","# which means for the same path, we use the same mean_value for the testing data in the column ""leaf_mean"""
"0","add_leaf_mean <- function(test_data, train_data_list) {"
"0","  # 初始化所有值为NA"
"0","  test_data$leaf_mean <- NA"
"0","  "
"0","  # 遍历训练数据列表中的每个叶节点"
"0","  for (i in seq_along(train_data_list)) {"
"0","    conditions <- train_data_list[[i]]$path"
"0","    mean_value <- train_data_list[[i]]$mean_value"
"0","    "
"0","    # 初始化一个逻辑向量，用于标记满足所有条件的行"
"0","    index_vector <- rep(TRUE, nrow(test_data))"
"0","    "
"0","    # 应用所有条件来更新索引向量"
"0","    for (condition in conditions) {"
"0","      parts <- strsplit(condition, "" = "")[[1]]"
"0","      variable <- parts[1]"
"0","      value <- as.numeric(parts[2])"
"0","      # 更新索引向量，仅保留同时满足当前条件的行"
"0","      index_vector <- index_vector & (test_data[[variable]] == value)"
"0","    }"
"0","    "
"0","    # 只有当index_vector不全为FALSE时，才更新leaf_mean"
"0","    if (any(index_vector)) {"
"0","      test_data$leaf_mean[index_vector] <- mean_value"
"0","    }"
"0","  }"
"0","  "
"0","  return(test_data)"
"0","}"
"0",""
