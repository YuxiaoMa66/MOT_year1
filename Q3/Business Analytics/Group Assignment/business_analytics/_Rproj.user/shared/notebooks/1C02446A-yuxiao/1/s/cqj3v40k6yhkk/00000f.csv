"0","# Recursive function to build the decision tree and prune it. Store the leaf nodes in a list and return it."
"0","Build_tree_prune <- function(data, IV, DV, depth, min_obs) {"
"0","  leaves <- list()"
"0","  "
"0","  recursive_build <- function(data, IV, DV, depth, min_obs, path = list()) {"
"0","    # 检查是否达到了递归的基本条件"
"0","    if (nrow(data) < min_obs || depth == 0 || length(IV) == 0) {"
"0","      return(list(data = data, path = path)) "
"0","    }"
"0","    "
"0","    # 选择一个变量进行分裂"
"0","    if (length(IV) > 1) {"
"0","      selected_var <- select_var(data, IV, DV)"
"0","    } else {"
"0","      selected_var <- IV[1]"
"0","    }"
"0","    "
"0","    # 按照选定的变量对数据进行分割"
"0","    left_data <- data[data[[selected_var]] == 0, ]"
"0","    right_data <- data[data[[selected_var]] == 1, ]"
"0","    "
"0","    # 如果任一子集的大小小于 min_obs，当前节点应被视为叶节点"
"0","    if (nrow(left_data) < min_obs || nrow(right_data) < min_obs) {"
"0","      return(list(data = data, path = path))"
"0","    }"
"0",""
"0","    new_path_left <- c(path, paste(selected_var, ""= 0""))"
"0","    new_path_right <- c(path, paste(selected_var, ""= 1""))"
"0","    "
"0","    left_leaves <- if (nrow(left_data) > 0) recursive_build(left_data, IV[!IV %in% selected_var], DV, depth - 1, min_obs, new_path_left) else NULL"
"0","    right_leaves <- if (nrow(right_data) > 0) recursive_build(right_data, IV[!IV %in% selected_var], DV, depth - 1, min_obs, new_path_right) else NULL"
"0",""
"0","    return(c(left_leaves, right_leaves))"
"0","  }"
"0","  "
"0","  leaves <- recursive_build(data, IV, DV, depth, min_obs)"
"0","  "
"0","  return(leaves)"
"0","}"
"0",""
